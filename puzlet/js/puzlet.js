// Generated by CoffeeScript 1.3.3
(function() {
  var ArrayMath, AxesLabels, BlabCoffee, BlabPlotter, BlabPrinter, CoffeeEvaluator, CoffeeResource, ComplexMath, CssResourceInline, CssResourceLinked, EvalBoxPlotter, FavIcon, Figure, GithubRibbon, HtmlResource, JsResourceInline, JsResourceLinked, JsonResource, Loader, MathJaxProcessor, NumericFunctions, OLDLoader, OLDPage, OLDResources, Page, Resource, ResourceInline, Resources, ScalarMath, TypeMath, getBlabFromQuery, getFileDivs, init,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  BlabCoffee = (function() {

    BlabCoffee.prototype.predefinedCoffee = "nm = numeric\nsize = nm.size\nmax = nm.max\nabs = nm.abs\npow = nm.pow\nsqrt = nm.sqrt\nexp = nm.exp\nlog = nm.log\nsin = nm.sin\ncos = nm.cos\ntan = nm.tan\nasin = nm.asin\nacos = nm.acos\natan = nm.atan\natan2 = nm.atan2\nceil = nm.ceil\nfloor = nm.floor\nround = nm.round\nrand = nm.rand\ncomplex = nm.complex\nconj = nm.conj\nlinspace = nm.linspace\nprint = nm.print\nplot = nm.plot\nplotSeries = nm.plotSeries\neplot = nm.plot\nfigure = nm.figure\npi = Math.PI\nj = complex 0, 1\nprint.clear()\neplot.clear()";

    BlabCoffee.prototype.basicOps = [["add", "add"], ["sub", "subtract"], ["mul", "multiply"], ["div", "divide"]];

    BlabCoffee.prototype.modOp = ["mod", "modulo"];

    BlabCoffee.prototype.eqOps = [["mod", "modulo"], ["eq", "equals"], ["lt", "lt"], ["gt", "gt"], ["leq", "leq"], ["geq", "geq"]];

    BlabCoffee.prototype.assignOps = ["addeq", "subeq", "muleq", "diveq", "modeq"];

    function BlabCoffee() {
      this.ops = this.basicOps.concat([this.modOp]).concat(this.eqOps);
      this.predefinedCoffeeLines = this.predefinedCoffee.split("\n");
    }

    BlabCoffee.prototype.initializeMath = function() {
      if (this.mathInitialized != null) {
        return;
      }
      window._$_ = PaperScript._$_;
      window.$_ = PaperScript.$_;
      new ScalarMath(this.ops);
      new ArrayMath(this.ops, this.assignOps);
      new ComplexMath(this.basicOps);
      new NumericFunctions;
      new BlabPrinter;
      new BlabPlotter;
      new EvalBoxPlotter;
      return this.mathInitialized = true;
    };

    BlabCoffee.prototype.compile = function(code, bare) {
      var codeLines, firstLine, js, lf, vanilla;
      if (bare == null) {
        bare = false;
      }
      lf = "\n";
      codeLines = code.split(lf);
      firstLine = codeLines[0];
      vanilla = firstLine === "#!vanilla";
      if (!vanilla) {
        this.initializeMath();
        codeLines = this.predefinedCoffeeLines.concat(codeLines);
        code = codeLines.join(lf);
      }
      js = CoffeeScript.compile(code, {
        bare: bare
      });
      if (!vanilla) {
        js = PaperScript.compile(js);
      }
      return js;
    };

    return BlabCoffee;

  })();

  TypeMath = (function() {

    function TypeMath(proto) {
      this.proto = proto;
    }

    TypeMath.prototype.setMethod = function(op) {
      return this.proto[op] = function(y) {
        return numeric[op](this, y);
      };
    };

    TypeMath.prototype.setUnaryMethod = function(op) {
      return this.proto[op] = function() {
        return numeric[op](this);
      };
    };

    TypeMath.prototype.overloadOperator = function(a, b) {
      return this.proto["__" + b] = this.proto[a];
    };

    return TypeMath;

  })();

  ScalarMath = (function(_super) {

    __extends(ScalarMath, _super);

    function ScalarMath(ops) {
      var a, b, op, _i, _len, _ref;
      this.ops = ops;
      ScalarMath.__super__.constructor.call(this, Number.prototype);
      _ref = this.ops;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        op = _ref[_i];
        a = op[0], b = op[1];
        this.setMethod(a);
        this.overloadOperator(a, b);
      }
      this.proto.pow = function(p) {
        return Math.pow(this, p);
      };
    }

    ScalarMath.prototype.setMethod = function(op) {
      return this.proto[op] = function(y) {
        return numeric[op](+this, y);
      };
    };

    return ScalarMath;

  })(TypeMath);

  ArrayMath = (function(_super) {

    __extends(ArrayMath, _super);

    function ArrayMath(ops, assignOps) {
      var a, b, op, pow, _i, _j, _len, _len1, _ref, _ref1;
      this.ops = ops;
      this.assignOps = assignOps;
      ArrayMath.__super__.constructor.call(this, Array.prototype);
      this.proto.size = function() {
        return [this.length, this[0].length];
      };
      this.proto.max = function() {
        return Math.max.apply(null, this);
      };
      numeric.zeros = function(m, n) {
        return numeric.rep([m, n], 0);
      };
      numeric.ones = function(m, n) {
        return numeric.rep([m, n], 1);
      };
      _ref = this.ops;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        op = _ref[_i];
        a = op[0], b = op[1];
        this.setMethod(a);
        this.overloadOperator(a, b);
      }
      _ref1 = this.assignOps;
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        op = _ref1[_j];
        this.setMethod(op);
      }
      this.setMethod("dot");
      this.setUnaryMethod("neg");
      this.overloadOperator("neg", "negate");
      this.setUnaryMethod("clone");
      this.setUnaryMethod("sum");
      this.proto.transpose = function() {
        return numeric.transpose(this);
      };
      Object.defineProperty(this.proto, 'T', {
        get: function() {
          return this.transpose();
        }
      });
      pow = numeric.pow;
      this.proto.pow = function(p) {
        return pow(this, p);
      };
      numeric.rand = function(sz) {
        if (sz == null) {
          sz = null;
        }
        if (sz) {
          return numeric.random(sz);
        } else {
          return Math.random();
        }
      };
    }

    return ArrayMath;

  })(TypeMath);

  ComplexMath = (function(_super) {

    __extends(ComplexMath, _super);

    function ComplexMath(ops) {
      var complex, j, j2, negj, op, _i, _len, _ref;
      this.ops = ops;
      ComplexMath.__super__.constructor.call(this, numeric.T.prototype);
      numeric.complex = function(x, y) {
        if (y == null) {
          y = 0;
        }
        return new numeric.T(x, y);
      };
      complex = numeric.complex;
      this.proto.size = function() {
        return [this.x.length, this.x[0].length];
      };
      _ref = this.ops;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        op = _ref[_i];
        this.defineOperators(op[0], op[1]);
      }
      this.proto.__negate = this.proto.neg;
      Object.defineProperty(this.proto, 'T', {
        get: function() {
          return this.transpose();
        }
      });
      Object.defineProperty(this.proto, 'H', {
        get: function() {
          return this.transjugate();
        }
      });
      this.proto.arg = function() {
        var x, y;
        x = this.x;
        y = this.y;
        return numeric.atan2(y, x);
      };
      this.proto.pow = function(p) {
        var a, nm, pa, r;
        nm = numeric;
        r = this.abs().x;
        a = this.arg();
        pa = a.mul(p);
        return complex(nm.cos(pa), nm.sin(pa)).mul(r.pow(p));
      };
      this.proto.sqrt = function() {
        return this.pow(0.5);
      };
      this.proto.log = function() {
        var a, r;
        r = this.abs().x;
        a = this.arg();
        return complex(numeric.log(r), a);
      };
      j = complex(0, 1);
      j2 = complex(0, 2);
      negj = complex(0, -1);
      this.proto.sin = function() {
        var e1, e2;
        e1 = (this.mul(j)).exp();
        e2 = (this.mul(negj)).exp();
        return (e1.sub(e2)).div(j2);
      };
      this.proto.cos = function() {
        var e1, e2;
        e1 = (this.mul(j)).exp();
        e2 = (this.mul(negj)).exp();
        return (e1.add(e2)).div(2);
      };
    }

    ComplexMath.prototype.defineOperators = function(op, op1) {
      var numericOld;
      numericOld = {};
      this.proto["__" + op1] = this.proto[op];
      numericOld[op] = numeric[op];
      return numeric[op] = function(x, y) {
        if (typeof x === "number" && y instanceof numeric.T) {
          return numeric.complex(x)[op](y);
        } else {
          return numericOld[op](x, y);
        }
      };
    };

    return ComplexMath;

  })(TypeMath);

  NumericFunctions = (function() {

    NumericFunctions.prototype.overrideFcns = ["sqrt", "sin", "cos", "exp", "log"];

    function NumericFunctions() {
      var f, nabs, natan2, nm, npow, _i, _len, _ref;
      _ref = this.overrideFcns;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        f = _ref[_i];
        this.override(f);
      }
      nm = numeric;
      npow = nm.pow;
      nm.pow = function(x, p) {
        if (x.pow != null) {
          return x.pow(p);
        } else {
          return npow(x, p);
        }
      };
      nabs = nm.abs;
      nm.abs = function(x) {
        if ((x.abs != null) && x instanceof nm.T) {
          return x.abs().x;
        } else {
          return nabs(x);
        }
      };
      natan2 = nm.atan2;
      nm.atan2 = function(y, x) {
        if (typeof x === "number" && typeof y === "number") {
          return Math.atan2(y, x);
        } else {
          return natan2(y, x);
        }
      };
    }

    NumericFunctions.prototype.override = function(name) {
      var f;
      f = numeric[name];
      return numeric[name] = function(x) {
        if (typeof x === "object" && (x[name] != null)) {
          return x[name]();
        } else {
          return f(x);
        }
      };
    };

    return NumericFunctions;

  })();

  BlabPrinter = (function() {

    function BlabPrinter() {
      var id, nm;
      nm = numeric;
      id = "blab_print";
      nm.print = function(x) {
        var container, htmlOut;
        container = $("#" + id);
        if (!container.length) {
          container = $("<div>", {
            id: id
          });
          htmlOut = $("#codeout_html");
          htmlOut.append(container);
        }
        return container.append("<pre>" + nm.prettyPrint(x) + "</pre>");
      };
      nm.print.clear = function() {
        var container;
        container = $("#" + id);
        if (container) {
          return container.empty();
        }
      };
    }

    return BlabPrinter;

  })();

  BlabPlotter = (function() {

    function BlabPlotter() {
      numeric.htmlplot = function(x, y, params) {
        var flot, htmlOut, _ref;
        if (params == null) {
          params = {};
        }
        flot = $("#flot");
        if (!flot.length) {
          flot = $("<div>", {
            id: "flot",
            css: {
              width: "600px",
              height: "300px"
            }
          });
          htmlOut = $("#codeout_html");
          htmlOut.append(flot);
        }
        if ((_ref = params.series) == null) {
          params.series = {
            color: "#55f"
          };
        }
        return $.plot($("#flot"), [numeric.transpose([x, y])], params);
      };
    }

    return BlabPlotter;

  })();

  EvalBoxPlotter = (function() {

    function EvalBoxPlotter() {
      var _this = this;
      this.container = $("#result_container");
      this.container.css({
        position: "absolute"
      });
      this.clear();
      numeric.plot = function(x, y, params) {
        if (params == null) {
          params = {};
        }
        return _this.plot(x, y, params);
      };
      numeric.plot.clear = function() {
        return _this.clear();
      };
      numeric.figure = function(params) {
        if (params == null) {
          params = {};
        }
        return _this.figure(params);
      };
      numeric.plotSeries = function(series, params) {
        if (params == null) {
          params = {};
        }
        return _this.plotSeries(series, params);
      };
      this.figures = [];
    }

    EvalBoxPlotter.prototype.clear = function() {
      this.plotCount = 0;
      return $(".eval_flot").remove();
    };

    EvalBoxPlotter.prototype.figure = function(params) {
      var flotId;
      if (params == null) {
        params = {};
      }
      flotId = "eval_plot_" + this.plotCount;
      this.figures[flotId] = new Figure(this.container, flotId, params);
      this.plotCount++;
      return flotId;
    };

    EvalBoxPlotter.prototype.plot = function(x, y, params) {
      var fig, flotId, _ref;
      if (params == null) {
        params = {};
      }
      flotId = (_ref = params.fig) != null ? _ref : this.figure(params);
      fig = this.figures[flotId];
      fig.plot(x, y);
      if (params.fig) {
        return null;
      } else {
        return flotId;
      }
    };

    EvalBoxPlotter.prototype.plotSeries = function(series, params) {
      var fig, flotId, _ref;
      if (params == null) {
        params = {};
      }
      flotId = (_ref = params.fig) != null ? _ref : this.figure(params);
      fig = this.figures[flotId];
      fig.plotSeries(series);
      if (params.fig) {
        return null;
      } else {
        return flotId;
      }
    };

    return EvalBoxPlotter;

  })();

  Figure = (function() {

    function Figure(container, flotId, params) {
      var _ref, _ref1,
        _this = this;
      this.container = container;
      this.flotId = flotId;
      this.params = params;
      this.w = this.container[0].offsetWidth;
      this.flot = $("<div>", {
        id: this.flotId,
        "class": "eval_flot",
        css: {
          position: "absolute",
          top: "0px",
          width: ((_ref = this.params.width) != null ? _ref : this.w - 50) + "px",
          height: ((_ref1 = this.params.height) != null ? _ref1 : 150) + "px",
          margin: "0px",
          marginLeft: "30px",
          marginTop: "20px",
          zIndex: 1
        }
      });
      this.container.append(this.flot);
      this.flot.hide();
      this.positioned = false;
      setTimeout((function() {
        return _this.setPos();
      }), 10);
    }

    Figure.prototype.setPos = function() {
      var e, idx, p, _i, _len, _ref, _ref1;
      p = null;
      _ref = $blab.evaluator;
      for (idx = _i = 0, _len = _ref.length; _i < _len; idx = ++_i) {
        e = _ref[idx];
        if ((typeof e === "string") && e === this.flotId) {
          p = idx;
        }
      }
      if (!p) {
        return;
      }
      this.flot.css({
        top: "" + (p * 22) + "px"
      });
      this.flot.show();
      if ((_ref1 = this.axesLabels) != null) {
        _ref1.position();
      }
      return this.positioned = true;
    };

    Figure.prototype.plot = function(x, y) {
      var d, line, nLines, v, _base, _i, _len, _ref;
      if ((_ref = (_base = this.params).series) == null) {
        _base.series = {
          color: "#55f"
        };
      }
      if ((y != null ? y.length : void 0) && (y[0].length != null)) {
        nLines = y.length;
        d = [];
        for (_i = 0, _len = y.length; _i < _len; _i++) {
          line = y[_i];
          v = numeric.transpose([x, line]);
          d.push(v);
        }
      } else {
        d = [numeric.transpose([x, y])];
      }
      if (!this.positioned) {
        this.flot.show();
      }
      $.plot(this.flot, d, this.params);
      if (!this.positioned) {
        this.flot.hide();
      }
      this.axesLabels = new AxesLabels(this.flot, this.params);
      if (this.positioned) {
        return this.axesLabels.position();
      }
    };

    Figure.prototype.plotSeries = function(series) {
      var _base, _ref;
      if ((_ref = (_base = this.params).series) == null) {
        _base.series = {
          color: "#55f"
        };
      }
      if (!this.positioned) {
        this.flot.show();
      }
      $.plot(this.flot, series, this.params);
      if (!this.positioned) {
        this.flot.hide();
      }
      this.axesLabels = new AxesLabels(this.flot, this.params);
      if (this.positioned) {
        return this.axesLabels.position();
      }
    };

    return Figure;

  })();

  AxesLabels = (function() {

    function AxesLabels(container, params) {
      this.container = container;
      this.params = params;
      if (this.params.xlabel) {
        this.xaxisLabel = this.appendLabel(this.params.xlabel, "xaxisLabel");
      }
      if (this.params.ylabel) {
        this.yaxisLabel = this.appendLabel(this.params.ylabel, "yaxisLabel");
      }
    }

    AxesLabels.prototype.appendLabel = function(txt, className) {
      var label;
      label = $("<div>", {
        text: txt
      });
      label.addClass("axisLabel");
      label.addClass(className);
      this.container.append(label);
      return label;
    };

    AxesLabels.prototype.position = function() {
      var _ref, _ref1;
      if ((_ref = this.xaxisLabel) != null) {
        _ref.css({
          marginLeft: (-this.xaxisLabel.width() / 2 + 10) + "px",
          marginBottom: "-20px"
        });
      }
      return (_ref1 = this.yaxisLabel) != null ? _ref1.css({
        marginLeft: "-27px",
        marginTop: (this.yaxisLabel.width() / 2 - 10) + "px"
      }) : void 0;
    };

    return AxesLabels;

  })();

  /* Not used - to obsolete
  
  complexMatrices: ->
  	
  	Array.prototype.complexParts = ->
  		A = this
  		[m, n] = size A
  		vParts = (v) -> [(a.x for a in v), (a.y for a in v)]
  		if not n
  			# Vector
  			[real, imag] = vParts A
  		else
  			# Matrix
  			real = new Array m
  			imag = new Array m
  			[real[m], imag[m]] = vParts(row) for row, m in A
  		[real, imag]
  	
  	# These could be made more efficient.
  	Array.prototype.real = -> this.complexParts()[0]
  	Array.prototype.imag = -> this.complexParts()[1]
  	
  	#Array.prototype.isComplex = ->
  	#	A = this
  	#	[m, n] = size A
  
  manualOverloadExamples: ->
  	# Not currently used - using numericjs instead.
  	
  	Number.prototype.__add = (y) ->
  		# ZZZ is this inefficient for scaler x+y?
  		if typeof y is "number"
  			return this + y
  		else if y instanceof Array
  			return (this + yn for yn in y)
  		else
  			undefined
  
  	Array.prototype.__add = (y) ->
  		if typeof y is "number"
  			return (x + y for x in this)
  		else if y instanceof Array
  			return (x + y[n] for x, n in this)
  		else
  			undefined
  */


  Resource = (function() {

    function Resource(spec) {
      this.spec = spec;
      this.url = this.spec.url;
      this["var"] = this.spec["var"];
      this.fileExt = Resource.getFileExt(this.url);
      this.loaded = false;
      this.head = document.head;
    }

    Resource.prototype.load = function(callback, type) {
      var success, t,
        _this = this;
      if (type == null) {
        type = "text";
      }
      success = function(data) {
        _this.content = data;
        return _this.postLoad(callback);
      };
      if (navigator.userAgent.indexOf("iPhone") !== -1) {
        document.title = this.url;
      }
      t = Date.now();
      return $.get(this.url + ("?t=" + t), success, type).always(function() {
        if (navigator.userAgent.indexOf("iPhone") !== -1) {
          document.title = "get " + _this.url;
        }
        return console.log("get", _this.url);
      });
    };

    Resource.prototype.postLoad = function(callback) {
      this.loaded = true;
      return typeof callback === "function" ? callback() : void 0;
    };

    Resource.prototype.isType = function(type) {
      return this.fileExt === type;
    };

    Resource.getFileExt = function(url) {
      var a, fileExt;
      a = document.createElement("a");
      a.href = url;
      return fileExt = (a.pathname.match(/\.[0-9a-z]+$/i))[0].slice(1);
    };

    Resource.typeFilter = function(types) {
      return function(resource) {
        var type, _i, _len;
        if (typeof types === "string") {
          return resource.isType(types);
        } else {
          for (_i = 0, _len = types.length; _i < _len; _i++) {
            type = types[_i];
            if (resource.isType(type)) {
              return true;
            }
          }
          return false;
        }
      };
    };

    return Resource;

  })();

  HtmlResource = (function(_super) {

    __extends(HtmlResource, _super);

    function HtmlResource() {
      return HtmlResource.__super__.constructor.apply(this, arguments);
    }

    return HtmlResource;

  })(Resource);

  ResourceInline = (function(_super) {

    __extends(ResourceInline, _super);

    function ResourceInline() {
      return ResourceInline.__super__.constructor.apply(this, arguments);
    }

    ResourceInline.prototype.load = function(callback) {
      var _this = this;
      return ResourceInline.__super__.load.call(this, function() {
        _this.element = $("<" + _this.tag + ">", {
          type: _this.mime,
          "data-url": _this.url
        });
        _this.element.text(_this.content);
        return typeof callback === "function" ? callback() : void 0;
      });
    };

    ResourceInline.prototype.inDom = function() {
      return $("" + this.tag + "[data-url='" + this.url + "']").length;
    };

    ResourceInline.prototype.appendToHead = function() {
      if (!this.inDom()) {
        return this.head.appendChild(this.element[0]);
      }
    };

    return ResourceInline;

  })(Resource);

  CssResourceInline = (function(_super) {

    __extends(CssResourceInline, _super);

    function CssResourceInline() {
      return CssResourceInline.__super__.constructor.apply(this, arguments);
    }

    CssResourceInline.prototype.tag = "style";

    CssResourceInline.prototype.mime = "text/css";

    return CssResourceInline;

  })(ResourceInline);

  CssResourceLinked = (function(_super) {

    __extends(CssResourceLinked, _super);

    function CssResourceLinked() {
      return CssResourceLinked.__super__.constructor.apply(this, arguments);
    }

    CssResourceLinked.prototype.load = function(callback) {
      var _this = this;
      this.style = document.createElement("link");
      this.style.setAttribute("type", "text/css");
      this.style.setAttribute("rel", "stylesheet");
      this.style.setAttribute("href", this.url);
      this.style.onload = function() {
        return _this.postLoad(callback);
      };
      return this.head.appendChild(this.style);
    };

    return CssResourceLinked;

  })(Resource);

  JsResourceInline = (function(_super) {

    __extends(JsResourceInline, _super);

    function JsResourceInline() {
      return JsResourceInline.__super__.constructor.apply(this, arguments);
    }

    JsResourceInline.prototype.tag = "script";

    JsResourceInline.prototype.mime = "text/javascript";

    return JsResourceInline;

  })(ResourceInline);

  JsResourceLinked = (function(_super) {

    __extends(JsResourceLinked, _super);

    function JsResourceLinked() {
      return JsResourceLinked.__super__.constructor.apply(this, arguments);
    }

    JsResourceLinked.prototype.load = function(callback) {
      var t,
        _this = this;
      if (this["var"] && window[this["var"]]) {
        console.log("Already loaded", this.url);
        return;
      }
      this.wait = true;
      this.script = document.createElement("script");
      this.script.setAttribute("type", "text/javascript");
      this.head.appendChild(this.script);
      this.script.onload = function() {
        return _this.postLoad(callback);
      };
      t = Date.now();
      return this.script.setAttribute("src", this.url + ("?t=" + t));
    };

    return JsResourceLinked;

  })(Resource);

  CoffeeResource = (function(_super) {

    __extends(CoffeeResource, _super);

    function CoffeeResource() {
      return CoffeeResource.__super__.constructor.apply(this, arguments);
    }

    CoffeeResource.prototype.load = function(callback) {
      var _this = this;
      return CoffeeResource.__super__.load.call(this, function() {
        _this.element = $("<script>", {
          type: "text/javascript",
          "data-url": _this.url
        });
        return typeof callback === "function" ? callback() : void 0;
      });
    };

    CoffeeResource.prototype.compile = function() {
      var js;
      js = CoffeeEvaluator.compile(this.content);
      this.element.text(js);
      return this.head.appendChild(this.element[0]);
    };

    return CoffeeResource;

  })(Resource);

  JsonResource = (function(_super) {

    __extends(JsonResource, _super);

    function JsonResource() {
      return JsonResource.__super__.constructor.apply(this, arguments);
    }

    JsonResource.prototype.load = function(callback) {
      return JsonResource.__super__.load.call(this, callback, "json");
    };

    return JsonResource;

  })(Resource);

  Resources = (function() {

    Resources.prototype.resourceTypes = {
      html: {
        blab: HtmlResource,
        ext: HtmlResource
      },
      css: {
        blab: CssResourceInline,
        ext: CssResourceLinked
      },
      js: {
        blab: JsResourceInline,
        ext: JsResourceLinked
      },
      coffee: {
        blab: CoffeeResource,
        ext: CoffeeResource
      },
      json: {
        blab: JsonResource,
        ext: JsonResource
      }
    };

    function Resources() {
      this.resources = [];
    }

    Resources.prototype.add = function(resourceSpecs) {
      var newResources, resource, spec, _i, _len;
      if (!resourceSpecs.length) {
        resourceSpecs = [resourceSpecs];
      }
      newResources = [];
      for (_i = 0, _len = resourceSpecs.length; _i < _len; _i++) {
        spec = resourceSpecs[_i];
        resource = this.createResource(spec);
        newResources.push(resource);
        this.resources.push(resource);
      }
      if (newResources.length === 1) {
        return newResources[0];
      } else {
        return newResources;
      }
    };

    Resources.prototype.createResource = function(spec) {
      var fileExt, location, url;
      url = spec.url;
      fileExt = Resource.getFileExt(url);
      location = url.indexOf("/") === -1 ? "blab" : "ext";
      spec.location = location;
      if (this.resourceTypes[fileExt]) {
        return new this.resourceTypes[fileExt][location](spec);
      } else {
        return null;
      }
    };

    Resources.prototype.load = function(filter, loaded) {
      var resource, resourceLoaded, resources, resourcesToLoad, _i, _len, _results,
        _this = this;
      filter = this.filterFunction(filter);
      resources = this.select(function(resource) {
        return !resource.loaded && filter(resource);
      });
      if (resources.length === 0) {
        if (typeof loaded === "function") {
          loaded();
        }
        return;
      }
      resourcesToLoad = 0;
      resourceLoaded = function() {
        resourcesToLoad--;
        if (resourcesToLoad === 0) {
          _this.appendToHead(filter);
          return typeof loaded === "function" ? loaded() : void 0;
        }
      };
      _results = [];
      for (_i = 0, _len = resources.length; _i < _len; _i++) {
        resource = resources[_i];
        resourcesToLoad++;
        _results.push(resource.load(function() {
          return resourceLoaded();
        }));
      }
      return _results;
    };

    Resources.prototype.loadUnloaded = function(loaded) {
      return this.load((function() {
        return true;
      }), loaded);
    };

    Resources.prototype.appendToHead = function(filter) {
      var resource, resources, _i, _len, _results;
      filter = this.filterFunction(filter);
      resources = this.select(function(resource) {
        return !(typeof resource.inDom === "function" ? resource.inDom() : void 0) && (resource.appendToHead != null) && filter(resource);
      });
      _results = [];
      for (_i = 0, _len = resources.length; _i < _len; _i++) {
        resource = resources[_i];
        _results.push(resource.appendToHead());
      }
      return _results;
    };

    Resources.prototype.select = function(filter) {
      var resource, _i, _len, _ref, _results;
      filter = this.filterFunction(filter);
      _ref = this.resources;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        resource = _ref[_i];
        if (filter(resource)) {
          _results.push(resource);
        }
      }
      return _results;
    };

    Resources.prototype.filterFunction = function(filter) {
      if (typeof filter === "function") {
        return filter;
      } else {
        return Resource.typeFilter(filter);
      }
    };

    return Resources;

  })();

  Loader = (function() {
    /*
    	[
    		"main.html",
    		"style.css",
    		"bar.js",
    		"foo.coffee",
    		"main.coffee",
    		"/some-repo/snippet.html",
    		"/other-repo/foo.css",
    		"/puzlet/js/d3.min.js",
    		"http://domain.com/script.js",
    		"/ode-fixed/ode.coffee"
    	]
    */

    Loader.prototype.coreResources = [
      {
        url: "http://code.jquery.com/jquery-1.8.3.min.js",
        "var": "jQuery"
      }, {
        url: "/puzlet/js/wiky.js",
        "var": "Wiky"
      }
    ];

    Loader.prototype.resourcesList = {
      url: "resources.json"
    };

    Loader.prototype.htmlResources = [
      {
        url: "/puzlet/css/coffeelab.css"
      }
    ];

    Loader.prototype.scriptResources = [
      {
        url: "/puzlet/js/coffeescript.js"
      }, {
        url: "/puzlet/js/acorn.js"
      }, {
        url: "/puzlet/js/numeric-1.2.6.js"
      }, {
        url: "/puzlet/js/compile.js"
      }
    ];

    function Loader(blab, render, done) {
      var _this = this;
      this.blab = blab;
      this.render = render;
      this.done = done;
      this.resources = new Resources;
      this.loadCoreResources(function() {
        return _this.loadResourceList(function() {
          return _this.loadHtmlCss(function() {
            return _this.loadScripts(function() {
              return _this.done();
            });
          });
        });
      });
    }

    Loader.prototype.loadCoreResources = function(callback) {
      this.resources.add(this.coreResources);
      return this.resources.loadUnloaded(callback);
    };

    Loader.prototype.loadResourceList = function(callback) {
      var list,
        _this = this;
      list = this.resources.add(this.resourcesList);
      return this.resources.loadUnloaded(function() {
        var url;
        _this.resources.add(_this.htmlResources);
        _this.resources.add(_this.scriptResources);
        _this.resources.add((function() {
          var _i, _len, _ref, _results;
          _ref = list.content;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            url = _ref[_i];
            _results.push({
              url: url
            });
          }
          return _results;
        })());
        return typeof callback === "function" ? callback() : void 0;
      });
    };

    Loader.prototype.loadHtmlCss = function(callback) {
      var _this = this;
      if (navigator.userAgent.indexOf("iPhone") !== -1) {
        document.title = "Puzlet LOAD";
      }
      return this.resources.load(["html", "css"], function() {
        var html, _i, _len, _ref;
        _ref = _this.resources.select("html");
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          html = _ref[_i];
          _this.render(html.content);
        }
        return typeof callback === "function" ? callback() : void 0;
      });
    };

    Loader.prototype.loadScripts = function(callback) {
      var _this = this;
      return this.resources.load(["js", "coffee"], function() {
        _this.compileCoffee();
        return typeof callback === "function" ? callback() : void 0;
      });
    };

    Loader.prototype.compileCoffee = function() {
      var coffee, _i, _len, _ref, _results;
      _ref = this.resources.select("coffee");
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        coffee = _ref[_i];
        _results.push(coffee.compile());
      }
      return _results;
    };

    return Loader;

  })();

  Page = (function() {

    function Page(blab) {
      this.blab = blab;
    }

    Page.prototype.mainContainer = function() {
      if (this.container != null) {
        return;
      }
      this.container = $("<div>", {
        id: "blab_container"
      });
      this.container.hide();
      $(document.body).append(this.container);
      return this.container.show();
    };

    Page.prototype.render = function(wikyHtml) {
      var htmlNode;
      if (this.container == null) {
        this.mainContainer();
      }
      htmlNode = this.htmlNode();
      htmlNode.append(Wiky.toHtml(wikyHtml));
      return this.pageTitle(wikyHtml);
    };

    Page.prototype.ready = function() {
      new MathJaxProcessor;
      new FavIcon;
      return new GithubRibbon(this.container, this.blab);
    };

    Page.prototype.htmlNode = function() {
      var html;
      html = "<div id=\"code_nodes\" data-module-id=\"\">\n<div class=\"code_node_container\" id=\"code_node_container_html\" data-node-id=\"html\" data-filename=\"main.html\">\n	<div class=\"code_node_output_container\" id=\"output_html\">\n		<div class=\"code_node_html_output\" id=\"codeout_html\"></div>\n	</div>\n</div>\n</div>";
      this.container.append(html);
      return $("#codeout_html");
    };

    Page.prototype.pageTitle = function(wikyHtml) {
      var matches;
      matches = wikyHtml.match(/[^|\n][=]{1,6}(.*?)[=]{1,6}[^a-z0-9][\n|$]/);
      if (matches != null ? matches.length : void 0) {
        return document.title = matches[1];
      }
    };

    return Page;

  })();

  FavIcon = (function() {

    function FavIcon() {
      var icon;
      icon = $("<link>", {
        rel: "icon",
        type: "image/png",
        href: "/puzlet/images/favicon.ico"
      });
      $(document.head).append(icon);
    }

    return FavIcon;

  })();

  GithubRibbon = (function() {

    function GithubRibbon(container, blab) {
      var html, src;
      this.container = container;
      this.blab = blab;
      src = "https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67";
      html = "<a href=\"https://github.com/puzlet/" + this.blab + "\" id=\"ribbon\" style=\"opacity:0.2\">\n<img style=\"position: absolute; top: 0; right: 0; border: 0;\" src=\"" + src + "\" alt=\"Fork me on GitHub\" data-canonical-src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png\"></a>";
      this.container.append(html);
      setTimeout((function() {
        return $("#ribbon").fadeTo(400, 1).fadeTo(400, 0.2);
      }), 2000);
    }

    return GithubRibbon;

  })();

  MathJaxProcessor = (function() {

    MathJaxProcessor.prototype.source = "http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default";

    MathJaxProcessor.prototype.mode = "HTML-CSS";

    function MathJaxProcessor() {
      var configScript, mathjax,
        _this = this;
      this.outputId = "blab_container";
      $blab.mathjaxConfig = function() {
        $.event.trigger("mathjaxPreConfig");
        window.MathJax.Hub.Config({
          jax: ["input/TeX", "output/" + _this.mode],
          tex2jax: {
            inlineMath: [["$", "$"], ["\\(", "\\)"]]
          },
          TeX: {
            equationNumbers: {
              autoNumber: "AMS"
            }
          },
          elements: [_this.outputId, "blab_refs"],
          showProcessingMessages: false,
          MathMenu: {
            showRenderer: true
          }
        });
        return window.MathJax.HTML.Cookie.Set("menu", {
          renderer: _this.mode
        });
      };
      configScript = $("<script>", {
        type: "text/x-mathjax-config",
        text: "$blab.mathjaxConfig();"
      });
      mathjax = $("<script>", {
        type: "text/javascript",
        src: this.source
      });
      $("head").append(configScript).append(mathjax);
      $(document).on("htmlOutputUpdated", function() {
        return _this.process();
      });
    }

    MathJaxProcessor.prototype.process = function() {
      var Hub, configElements, queue,
        _this = this;
      if (typeof MathJax === "undefined" || MathJax === null) {
        return;
      }
      this.id = this.outputId;
      Hub = MathJax.Hub;
      queue = function(x) {
        return Hub.Queue(x);
      };
      queue(["PreProcess", Hub, this.id]);
      queue(["Process", Hub, this.id]);
      configElements = function() {
        return Hub.config.elements = [_this.id];
      };
      return queue(configElements);
    };

    return MathJaxProcessor;

  })();

  CoffeeEvaluator = (function() {

    function CoffeeEvaluator() {}

    CoffeeEvaluator.compile = function(code, bare) {
      var js, _ref;
      if (bare == null) {
        bare = false;
      }
      if ((_ref = CoffeeEvaluator.blabCoffee) == null) {
        CoffeeEvaluator.blabCoffee = new BlabCoffee;
      }
      return js = CoffeeEvaluator.blabCoffee.compile(code, bare);
    };

    CoffeeEvaluator["eval"] = function(code, js) {
      if (js == null) {
        js = null;
      }
      if (!js) {
        js = CoffeeEvaluator.compile(code);
      }
      eval(js);
      return js;
    };

    return CoffeeEvaluator;

  })();

  init = function() {
    var blab, loader, page, ready, render;
    window.$pz = {};
    window.$blab = {};
    if (window.console == null) {
      window.console = {};
    }
    if (window.console.log == null) {
      window.console.log = (function() {});
    }
    blab = window.location.pathname.split("/")[1];
    if (!(blab && blab !== "puzlet.github.io")) {
      return;
    }
    page = new Page(blab);
    render = function(wikyHtml) {
      return page.render(wikyHtml);
    };
    ready = function() {
      return page.ready();
    };
    return loader = new Loader(blab, render, ready);
  };

  init();

  getFileDivs = function(blab) {};

  getBlabFromQuery = function() {
    var blab, h, p, query;
    query = location.search.slice(1);
    if (!query) {
      return null;
    }
    h = query.split("&");
    p = h != null ? h[0].split("=") : void 0;
    return blab = p.length && p[0] === "blab" ? p[1] : null;
  };

  OLDResources = (function() {

    function OLDResources(spec) {
      this.spec = spec;
      this.head = document.getElementsByTagName('head')[0];
      this.resources = this.spec.resources;
      this.load();
    }

    OLDResources.prototype.load = function() {
      var name, resource, resources, url;
      this.resourcesToLoad = 0;
      resources = this.resources;
      if (!resources) {
        this.spec.loaded();
        return;
      }
      this.wait = false;
      for (name in resources) {
        resource = resources[name];
        url = resource.url;
        if (resource.ajax) {
          this.addFile(resource);
        } else {
          if (url.indexOf(".js") !== -1) {
            this.addScript(resource);
          } else if (url.indexOf(".css") !== -1) {
            this.addCss(resource);
          } else {

          }
        }
      }
      if (!this.wait && this.resourcesToLoad === 0) {
        return this.spec.loaded();
      }
    };

    OLDResources.prototype.addScript = function(resource) {
      var js, t, url,
        _this = this;
      if (window[resource["var"]]) {
        console.log("Already loaded", resource);
        return;
      }
      url = resource.url;
      this.wait = true;
      this.resourcesToLoad++;
      t = Date.now();
      js = document.createElement("script");
      js.setAttribute("src", url + ("?t=" + t));
      js.setAttribute("type", "text/javascript");
      js.setAttribute("class", this.spec.resourcesClass);
      js.onload = function() {
        return _this.resourceLoaded(resource);
      };
      return document.head.appendChild(js);
    };

    OLDResources.prototype.addCss = function(resource) {
      var css, url,
        _this = this;
      url = resource.url;
      this.wait = true;
      this.resourcesToLoad++;
      css = document.createElement("link");
      css.setAttribute("href", url);
      css.setAttribute("rel", "stylesheet");
      css.setAttribute("type", "text/css");
      css.setAttribute("class", this.spec.resourcesClass);
      css.onload = function() {
        return _this.resourceLoaded(resource);
      };
      return document.head.appendChild(css);
    };

    OLDResources.prototype.addFile = function(resource) {
      var url,
        _this = this;
      url = resource.url;
      this.wait = true;
      this.resourcesToLoad++;
      return $.get(url, function(data) {
        console.log("^^^^^^^^old get");
        resource.content = data;
        return _this.resourceLoaded(resource);
      });
    };

    OLDResources.prototype.resourceLoaded = function(resource) {
      console.log("Loaded", resource);
      this.resourcesToLoad--;
      if (this.resourcesToLoad === 0) {
        return this.spec.loaded(this.resources);
      }
    };

    OLDResources.prototype.removeAll = function(resourcesClass) {
      var resources;
      resources = $("." + resourcesClass);
      if (resources.length) {
        return resources.remove();
      }
    };

    return OLDResources;

  })();

  OLDLoader = (function() {
    var res;

    res = {
      blab: {
        markup: {
          url: "main.html"
        },
        css: {
          url: "main.css"
        },
        scripts: {
          main: {
            url: "main.js"
          },
          foo: {
            url: "foo.coffee"
          }
        }
      },
      libraries: {
        d3: {
          url: "d3"
        },
        numeric: {
          url: ""
        },
        flot: {
          url: ""
        },
        x: {
          url: "/blabId/foo.js"
        }
      }
    };

    function OLDLoader(blab) {
      this.blab = blab;
    }

    OLDLoader.prototype.loadCoreResources = function(callback) {
      var spec;
      spec = {
        resources: {
          jQuery: {
            url: "http://code.jquery.com/jquery-1.8.3.min.js",
            "var": "jQuery"
          },
          puzletCss: {
            url: "/puzlet/css/coffeelab.css"
          },
          Wiky: {
            url: "/puzlet/js/wiky.js",
            "var": "Wiky"
          }
        },
        resourcesClass: "core_resources",
        loaded: function() {
          return callback();
        }
      };
      return new OLDResources(spec);
    };

    OLDLoader.prototype.loadBlabMarkup = function(callback) {
      var spec;
      spec = {
        resources: {
          mainHtml: {
            url: "main.html",
            ajax: true
          },
          mainCss: {
            url: "main.css"
          }
        },
        resourcesClass: "blab_markup_resources",
        loaded: function(resources) {
          return callback(resources);
        }
      };
      return new OLDResources(spec);
    };

    OLDLoader.prototype.loadBlabResourcesFile = function(callback) {
      var _this = this;
      return $.get("resources.json", function(data) {
        return callback(data);
      });
    };

    OLDLoader.prototype.loadExtras = function(callback) {
      return this.loadBlabResourcesFile(function(res) {
        var idx, r, spec, _i, _len;
        spec = {
          resources: {
            numeric: {
              url: "/puzlet/js/numeric-1.2.6.js",
              "var": "numeric"
            },
            flot: {
              url: "/puzlet/js/jquery.flot.min.js"
            },
            jQueryUiCss: {
              url: "http://code.jquery.com/ui/1.9.2/themes/smoothness/jquery-ui.css"
            },
            jQueryUi: {
              url: "http://code.jquery.com/ui/1.9.2/jquery-ui.min.js"
            }
          },
          resourcesClass: "extra_resources",
          loaded: function() {
            return callback();
          }
        };
        for (idx = _i = 0, _len = res.length; _i < _len; idx = ++_i) {
          r = res[idx];
          spec.resources["extra" + idx] = {
            url: r
          };
        }
        return new OLDResources(spec);
      });
    };

    OLDLoader.prototype.loadMainJs = function(callback) {
      var spec;
      spec = {
        resources: {
          mainJs: {
            url: "main.js"
          }
        },
        resourcesClass: "main_resources",
        loaded: function() {
          return callback();
        }
      };
      return new OLDResources(spec);
    };

    OLDLoader.prototype.loadFavIcon = function() {
      var icon;
      icon = $("<link>", {
        rel: "icon",
        type: "image/png",
        href: "/puzlet/images/favicon.ico"
      });
      return $(document.head).append(icon);
    };

    return OLDLoader;

  })();

  OLDPage = (function() {

    function OLDPage(blab, loader, callback) {
      var _this = this;
      this.blab = blab;
      this.loader = loader;
      this.callback = callback;
      this.loader.loadBlabMarkup(function(resources) {
        var wiky;
        console.log("blab resources", resources.mainHtml);
        wiky = resources.mainHtml.content;
        return _this.render(wiky);
      });
    }

    OLDPage.prototype.render = function(wiky) {
      var container,
        _this = this;
      Array.prototype.dot = function(y) {
        return numeric.dot(+this, y);
      };
      container = $("<div>", {
        id: "blab_container"
      });
      container.hide();
      $(document.body).append(container);
      this.htmlNode(container);
      $("#codeout_html").append(Wiky.toHtml(wiky));
      container.show();
      this.pageTitle(wiky);
      new MathJaxProcessor;
      return this.loader.loadExtras(function() {
        return _this.loader.loadMainJs(function() {
          _this.loader.loadFavIcon();
          _this.githubForkRibbon(_this.blab);
          return _this.callback();
        });
      });
    };

    OLDPage.prototype.htmlNode = function(container) {
      var html;
      html = "<div id=\"code_nodes\" data-module-id=\"\">\n<div class=\"code_node_container\" id=\"code_node_container_html\" data-node-id=\"html\" data-filename=\"main.html\">\n	<div class=\"code_node_output_container\" id=\"output_html\">\n		<div class=\"code_node_html_output\" id=\"codeout_html\"></div>\n	</div>\n</div>\n</div>";
      return container.append(html);
    };

    OLDPage.prototype.pageTitle = function(wiky) {
      var matches;
      matches = wiky.match(/[^|\n][=]{1,6}(.*?)[=]{1,6}[^a-z0-9][\n|$]/);
      if (matches != null ? matches.length : void 0) {
        return document.title = matches[1];
      }
    };

    OLDPage.prototype.githubForkRibbon = function() {
      var html, src;
      src = "https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67";
      html = "<a href=\"https://github.com/puzlet/" + this.blab + "\" id=\"ribbon\" style=\"opacity:0.2\">\n<img style=\"position: absolute; top: 0; right: 0; border: 0;\" src=\"" + src + "\" alt=\"Fork me on GitHub\" data-canonical-src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png\"></a>";
      $("#blab_container").append(html);
      return setTimeout((function() {
        return $("#ribbon").fadeTo(400, 1).fadeTo(400, 0.2);
      }), 2000);
    };

    return OLDPage;

  })();

}).call(this);
